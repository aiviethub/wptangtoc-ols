#!/bin/bash
function check_thu_thi_chmod(){
local NAME=$1
local wp_config_path="/usr/local/lsws/$NAME/html/wp-config.php"
local TIMESTAMP_FILE="/usr/local/lsws/$NAME/.check_chmod_chown_wptangtoc_ols_auto"

if [[ -f $wp_config_path ]];then
if [[ ! -f $TIMESTAMP_FILE ]];then
touch $TIMESTAMP_FILE
fi

if [ "$wp_config_path" -nt "$TIMESTAMP_FILE" ]; then #giải thích nếu như temp timestamp này mà cũ hơn tệp wp_config thì nó sẽ chạy true
touch $TIMESTAMP_FILE #gán giá trị
. /etc/wptt/wptt-phan-quyen2 $NAME >/dev/null 2>&1
fi
fi
}

for entry in $(ls -A /etc/wptt/vhost); do
NAME=$(echo $entry | sed 's/^.//' | sed 's/.conf//')
if [ "$NAME" != "${NAME/./}" ] && [ "$NAME" != '.' ]; then #điều kiện domain phải có dấu . và lỗi chỉ có only .
check_thu_thi_chmod $NAME
fi
done


