#!/bin/bash
# @author: Gia Tuấn
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2022
echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Quản lý PHP => Kích hoạt PHP ioncube                                   |"
echo "========================================================================="
echo ""
echo ""
. /etc/wptt/.wptt.conf
echo "Đây là một extension PHP để sử dụng giải mã php.\ Khi bạn sử dụng plugin nào đó mà tác giả bảo về bản quyền của họ bằng cách mã hóa ioncube php\ khi được mã hóa bằng ioncube bạn cần phải có PHP extension ioncube mới có thể sử dụng được plugin đó"
echo "Đây không phải là tính năng giúp tăng tốc website nó thực chất còn làm hại đến tốc độ website của bạn"
read -p "Kích hoạt ioncube PHP (y/n): " dongy

if [[ "$dongy" != "y" ]]; then
        . /etc/wptt/wptt-php-ini-main 1
        exit
fi


. /etc/wptt/.wptt.conf
. /etc/wptt/echo-color
. /etc/wptt/php/wptt-php-version-domain 123

echo "Lựa chọn phiên bản PHP bạn muốn cài đặt extension ioncube PHP:"
function lua_chon_NAME() {
	LSPHP=""
	if [ "$(ls /usr/local/lsws)" ]; then
		selects=()
		for entry in $(ls /usr/local/lsws); do
			LSPHP=$(echo $entry | grep 'lsphp')
				selects+=("$LSPHP")
		done
		PS3="
-//- Nhap lua chon website cua ban [0=Thoat]: "
		select select in ${selects[@]}; do
			LSPHP=$select
			index=$REPLY
			break
		done
	else
		clear
		echo "webserver khong bat ky phien ban php nao ton tai tren he thong cua ban."
		exit
	fi
}
lua_chon_NAME


if [[ $LSPHP = "lsphp81" ]];then
echo "Phien ban php 8.1 khong duoc ho tro ioncube"
        . /etc/wptt/wptt-php-ini-main 1
		exit
fi

if [[ $LSPHP = "lsphp80" ]];then
echo "Phien ban php 8.0 khong duoc ho tro ioncube"
        . /etc/wptt/wptt-php-ini-main 1
exit
fi


if [[ -f /usr/local/lsws/$LSPHP/lib64/php/modules/ioncube.so ]]; then
echo "Bạn đã cài đặt ioncube $LSPHP trước đó rồi"
        . /etc/wptt/wptt-php-ini-main 1
exit
fi
_runing "Cài đặt Ioncube extension $LSPHP"
        echo '[litespeed]
name=LiteSpeed Tech Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/centos/$releasever/$basearch/
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-update]
name=LiteSpeed Tech Update Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/centos/$releasever/update/$basearch/
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-edge]
name=LiteSpeed Tech Edge Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/edge/centos/$releasever/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-edge-update]
name=LiteSpeed Tech Edge Update Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/edge/centos/$releasever/update/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed
' >/etc/yum.repos.d/litespeed.repo

yum install $LSPHP-ioncube -y >/dev/null 2>&1

        echo '[litespeed]
name=LiteSpeed Tech Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/centos/$releasever/$basearch/
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-update]
name=LiteSpeed Tech Update Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/centos/$releasever/update/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-edge]
name=LiteSpeed Tech Edge Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/edge/centos/$releasever/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-edge-update]
name=LiteSpeed Tech Edge Update Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/edge/centos/$releasever/update/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed
' >/etc/yum.repos.d/litespeed.repo

systemctl restart lsws
/usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
_rundone "Cài đặt Ioncube extension $LSPHP"

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]];then
. /etc/wptt/wptt-php-ini-main 1
fi

