#!/bin/bash
echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Quan ly PHP => Kich hoat PHP ioncube                                   |"
echo "========================================================================="
echo ""
echo ""
. /etc/wptt/.wptt.conf
echo "Day la mot extension PHP de su dung giai ma php.\ Khi ban su dung plugin nao do ma tac gia bao ve ban quyen cua ho bang cach ma hoa ioncube php\ khi duoc ma hoa bang ioncube ban can phai co ioncube moi co the su dung duoc plugin"
echo "Day khong phai la tinh nang giup tang toc website no thuc chat lam hai toc do website cua ban"
read -p "Kich hoat ioncube PHP (y/n): " dongy

if [[ "$dongy" != "y" ]]; then
        . /etc/wptt/wptt-php-ini-main
        exit
fi

if [[ "$php_version_check" != "8.0" ]]; then
        echo "Dang tien hanh cai them php ioncube..."
        echo '[litespeed]
name=LiteSpeed Tech Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/centos/$releasever/$basearch/
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-update]
name=LiteSpeed Tech Update Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/centos/$releasever/update/$basearch/
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-edge]
name=LiteSpeed Tech Edge Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/edge/centos/$releasever/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-edge-update]
name=LiteSpeed Tech Edge Update Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/edge/centos/$releasever/update/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed
' >/etc/yum.repos.d/litespeed.repo

lsphp=($(ls /usr/local/lsws | grep 'lsphp' | sed 's/^lsphp//g'))
ioncube_khong_ho_tro=(
	80
	)
for phpioncube in ${lsphp[@]};do
	if [[ ! "$phpioncube" =~ "$ioncube_khong_ho_tro" ]];then
        yum install lsphp${phpioncube}-ioncube -y
	fi
done

        echo '[litespeed]
name=LiteSpeed Tech Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/centos/$releasever/$basearch/
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-update]
name=LiteSpeed Tech Update Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/centos/$releasever/update/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-edge]
name=LiteSpeed Tech Edge Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/edge/centos/$releasever/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed

[litespeed-edge-update]
name=LiteSpeed Tech Edge Update Repository for CentOS $releasever - $basearch
baseurl=http://rpms.litespeedtech.com/edge/centos/$releasever/update/$basearch/
failovermethod=priority
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-litespeed
' >/etc/yum.repos.d/litespeed.repo

RED='\033[1;32m'
NC='\033[0m'
echo -e "${RED}                                              
               ........               
          .......    .....            
       .:..                   .:::.   
     .:.                    .:::::::. 
    ::                    .:::::::::. 
   :.                   .::::::::::.  
  :.                  .::::::::::.    
 .:      ..:.       .::::::::::.      
 :.    .:::::::.  .::::::::::.     .: 
 :.    .:::::::::::::::::::.       .: 
 :.     .::::::::::::::::.         .: 
 .:       .::::::::::::.           :. 
  :.        .::::::::.            .:  
   :.         .::::.             .:   
    ::                          ::    
     .:.                      .:.     
       .::.                .::.       
          .......    .......          
               ........               

${NC}"
systemctl restart lsws
        echo "kich hoat thanh cong ioncube php"
else
        echo "Bao loi error!!!"
        echo "PHP ioncube PHP 8.0 thi hien tai chua ho tro"
        echo "Neu ban muon su dung ioncube hay quay tro lai menu thay doi phien ban php ve cu hon de cai dat ioncube php nhe"
fi
