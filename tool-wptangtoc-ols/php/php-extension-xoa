#!/bin/bash
# @author: Gia Tuấn
# @website: https://wptangtoc.com
# @since: 2022

echo "Lựa chọn phiên bản PHP bạn muốn cài đặt thêm PHP extension:"
function lua_chon_NAME() {
	LSPHP=""
	if [ "$(ls /usr/local/lsws)" ]; then
		selects=()
		for entry in $(ls /usr/local/lsws); do
			LSPHP=$(echo $entry | grep 'lsphp')
				selects+=("$LSPHP")
		done
		PS3="
-//- Nhập lựa chọn phiên bản PHP của bạn muốn cài đặt [0=Thoát]: "
		select select in ${selects[@]}; do
			LSPHP=$select
			index=$REPLY
			break
		done
	else
		clear
		echo "webserver khong bat ky phien ban php nao ton tai tren he thong cua ban."
		exit
	fi
}
lua_chon_NAME
. /etc/wptt/echo-color

if [[ ! -d /usr/local/lsws/$LSPHP ]];then
echoDo "Khong xac dinh duoc dir php"
exit
fi

_runing "Tiến hành quét extension $LSPHP"
php_extension_da_cai_dat=($(yum list installed | grep $LSPHP | cut -f2-10 -d '-'  | cut -f1 -d '.' | sed '1d' | sed '/^$/d'|sort | uniq))
php_extension=($(yum search lsphp | grep $LSPHP | cut -f2-10 -d '-'  | cut -f1 -d '.' | sed '/^$/d'|sort | uniq ))

if [[ -f /tmp/php_extension.txt ]];then
rm -f /tmp/php_extension.txt
fi

for phpexe in $php_extension_da_cai_dat;do
echo "$phpexe" >> /tmp/php_extension.txt
done

_rundone "Tiến hành quét extension $LSPHP"

selects=()
for entry in $(cat /tmp/php_extension.txt); do
	selects+=("$entry")
done

PS3="
-//- Nhập lựa chọn của bạn [0=Thoát]: "
select select in ${selects[@]}; do
	php_extension_chon=$select
	break
done


if [[ $php_extension_chon = "" ]];then
echoDo "Ban chua lua chon extension PHP"
exit
fi

_runing "Xóa $lsphp extension $php_extension_chon"
yum remove $LSPHP-$php_extension_chon -y >/dev/null 2>&1

php_extension_check_lai=$(yum list installed | grep $LSPHP | cut -f2-10 -d '-'  | cut -f1 -d '.' | sed '1d' | sed '/^$/d'|sort | uniq| grep -w "$php_extension_chon")
if [[ $php_extension_check_lai ]];then
_runloi "Xóa $lsphp extension $php_extension_chon"
else
_rundone "Xóa $lsphp extension $php_extension_chon"
fi

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]];then
. /etc/wptt/wptt-php-ini-main 1
fi

