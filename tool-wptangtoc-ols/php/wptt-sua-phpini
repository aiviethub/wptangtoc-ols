#!/bin/bash
echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Quản lý PHP => Cấu hình PHP.ini                                        |"
echo "========================================================================="
echo ""
. /etc/wptt/.wptt.conf
. /etc/wptt/php/wptt-php-version-domain 1

echo "Lựa chọn phiên bản PHP bạn muốn chỉnh sửa:"
function lua_chon_NAME() {
	LSPHP=""
	if [ "$(ls /usr/local/lsws)" ]; then
		selects=()
		for entry in $(ls /usr/local/lsws); do
			LSPHP=$(echo $entry | grep 'lsphp')
				selects+=("$LSPHP")
		done
		PS3="
-//- Nhập lựa chọn phiên bản PHP bạn muốn chỉnh sửa [0=Thoát]: "
		select select in ${selects[@]}; do
			LSPHP=$select
			index=$REPLY
			break
		done
	else
		clear
		echo "webserver khong bat ky phien ban php nao ton tai tren he thong cua ban."
		exit
	fi
}
lua_chon_NAME

if [[ $LSPHP = '0' || $LSPHP = '' ]];then
check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]];then
. /etc/wptt/wptt-php-ini-main 1
fi

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "99" ]];then
. /etc/wptt/wptt-cau-hinh-websever-main 1
fi
exit
fi

echo "Moi thu minh da cau hinh toi uu het roi"
echo "Neu ban co nhu cau uploads file dung luon lon thi khi da uploads xong thi hay vui long khoi phuc ve nhu cu de dam bao hieu suat va bao mat"
echo "Chung minh cung co ho tro tinh nang khoi phuc trong menu cua WPTangToc OLS"
echo -e "Hay than can nhac thuc su ban dang lam gi ${RED} Can nhac truoc khi chinh sua file php.ini ${NC}"
read -p "Xac nhan ban muon chinh sua php.ini (y/n): " check
if [[ "$check" = "y" ]]; then
if [[ $editor_cau_hinh = "" ]];then
editor_cau_hinh="nano" 
fi
echo "Su dung cong cu editor: $editor_cau_hinh de chinh sua"
sleep 2
if [[ $editor_cau_hinh = "nano" ]];then
    echo "Ctrl + O de luu lai va ctrl + X de thoat ra, ctrl + W de tim kiem nhanh"
    sleep 3
fi
	# php_server=$(php -i | grep php.ini | grep Loaded | cut -c 30-80 | cut -f5 -d "/")
	php=$(echo "/usr/local/lsws/$LSPHP/etc/php.ini")
	if [[ ! -f $php ]];then
		echoDo "khong xac dinh duoc duong dan php.ini"
exit
	fi

check_thay_doi=$(md5sum $php |cut -f1 -d ' ' > /tmp/php_cau_hinh_wptangtoc)
echo "$php" > /tmp/php_cau_hinh_wptangtoc2
$editor_cau_hinh "$php"
php=$(cat /tmp/php_cau_hinh_wptangtoc2)
	if [[ $(cat /tmp/php_cau_hinh_wptangtoc) != $(md5sum $php |cut -f1 -d ' ')  ]];then
	_runing "Khởi động lại PHP để cập nhật giá trị"
/usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
	_rundone "Khởi động lại PHP để cập nhật giá trị"
fi


fi

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]];then
. /etc/wptt/wptt-php-ini-main 1
fi

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "99" ]];then
. /etc/wptt/wptt-cau-hinh-websever-main 1
fi

