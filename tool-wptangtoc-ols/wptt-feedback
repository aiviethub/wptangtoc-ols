#!/bin/bash
#
#
# @author: Gia Tuấn
# @website: https://wptangtoc.com
# @since: 2021
clear

echo -e "+-----------------------------------------------------------------------+"
echo "|                                                                       |"
echo "|                        Gửi yêu cầu đến Gia Tuấn		|"
echo "|                                                                       |"
echo -e "+-----------------------------------------------------------------------+"

read -p "Nhập nội dung gửi đến mình: " noidung

. /etc/wptt/.wptt.conf
telegram_api_giatuan="1972457211:AAFcUwczKNmlOtLKmAuxF3jRPp8smSYqGqQ"
telegram_id_giatuan="1941819605"
client_ip=$(echo $SSH_CLIENT | awk '{ print $1}')
vps_ip=$(curl -s myip.directadmin.com)
if [[ "$vps_ip" = "" ]]; then
    vps_ip=$(curl -s ifconfig.me)
fi
date="$(date "+%d-%m-%Y %H:%M")"
info_ip=https://ipinfo.io/${client_ip}
text="
-------------------------------------
Thông tin yêu cầu WPTangToc OLS
-------------------------------------
Nội dung: $noidung
IP Máy trạm: *${client_ip}* - [Thông tin chi tiết](${info_ip})
IP webserver: $vps_ip
Thời điểm: ${date}
Website: `for entry in $(ls -A /etc/wptt/vhost); do
    domain=$( echo $entry | sed 's/^.//' | sed 's/.conf//')
    path="/usr/local/lsws/$domain/html"
    i=1

    if [[ -d "$path" ]]; then
         echo "$domain ,"
    fi
  done
`
-------------------------------------
WPTangToc OLS phiên bản : $version_wptangtoc_ols
Phát triển bởi [Gia Tuấn](https://wptangtoc.com/gia-tuan)
"
url_tele="https://api.telegram.org/bot${telegram_api_giatuan}/sendMessage"
curl -s -d "chat_id=$telegram_id_giatuan&text=${text}&disable_web_page_preview=true&parse_mode=markdown" $url_tele > /dev/null
clear
echo "Nội dung tin nhắn đã gửi đến Gia Tuấn (Tác giả phần mềm WPTangToc OLS)"
echo "Cảm ơn bạn đã gửi yêu cầu đến với mình"
sleep 5
wptangtoc
