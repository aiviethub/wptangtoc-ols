    #!/bin/bash
# @author: Gia Tu·∫•n
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2025


function huong_dan(){
T√≠nh nƒÉng Qu·∫£n l√Ω Sao l∆∞u v√† Kh√¥i ph·ª•c [Backup & Restore] trong WPTangToc OLS l√† m·ªôt c√¥ng c·ª• thi·∫øt y·∫øu gi√∫p b·∫°n b·∫£o v·ªá d·ªØ li·ªáu website v√† d·ªÖ d√†ng ph·ª•c h·ªìi khi c√≥ s·ª± c·ªë x·∫£y ra. üîÑüîí

Gi·ªõi thi·ªáu ng·∫Øn g·ªçn:

M·ª•c ƒë√≠ch: ƒê·∫£m b·∫£o an to√†n cho d·ªØ li·ªáu website [bao g·ªìm t·ªáp tin m√£ ngu·ªìn v√† c∆° s·ªü d·ªØ li·ªáu] b·∫±ng c√°ch t·∫°o c√°c b·∫£n sao l∆∞u d·ª± ph√≤ng v√† cho ph√©p kh√¥i ph·ª•c l·∫°i tr·∫°ng th√°i tr∆∞·ªõc ƒë√≥ m·ªôt c√°ch nhanh ch√≥ng.
C√°ch ho·∫°t ƒë·ªông [th∆∞·ªùng th·∫•y]:
 * T·∫°o b·∫£n sao l∆∞u [Backup]:
 * Th·ªß c√¥ng: Cho ph√©p ng∆∞·ªùi d√πng t·∫°o b·∫£n sao l∆∞u ngay l·∫≠p t·ª©c cho m·ªôt ho·∫∑c nhi·ªÅu website.
 * T·ª± ƒë·ªông/L√™n l·ªãch: H·ªó tr·ª£ thi·∫øt l·∫≠p l·ªãch sao l∆∞u ƒë·ªãnh k·ª≥ [v√≠ d·ª•: h√†ng ng√†y, h√†ng tu·∫ßn, h√†ng th√°ng].
 * L∆∞u tr·ªØ: C√≥ th·ªÉ l∆∞u tr·ªØ b·∫£n sao l∆∞u c·ª•c b·ªô tr√™n m√°y ch·ªß ho·∫∑c h·ªó tr·ª£ t·∫£i l√™n c√°c d·ªãch v·ª• l∆∞u tr·ªØ ƒë√°m m√¢y [v√≠ d·ª•: Google Drive, OneDrive, Telegram - ƒë·∫∑c bi·ªát v·ªõi c√°c phi√™n b·∫£n Premium].
 * Kh√¥i ph·ª•c [Restore]:
 * Cho ph√©p ch·ªçn m·ªôt b·∫£n sao l∆∞u t·ª´ danh s√°ch v√† kh√¥i ph·ª•c to√†n b·ªô website [t·ªáp tin v√† database] v·ªÅ th·ªùi ƒëi·ªÉm ƒë√≥.
 * v.v.v

L·ª£i √≠ch:
 * An to√†n d·ªØ li·ªáu: Ph√≤ng ng·ª´a m·∫•t m√°t d·ªØ li·ªáu do l·ªói ng∆∞·ªùi d√πng, t·∫•n c√¥ng, ho·∫∑c s·ª± c·ªë ph·∫ßn c·ª©ng/ph·∫ßn m·ªÅm.
 * Ph·ª•c h·ªìi nhanh ch√≥ng: Gi·∫£m thi·ªÉu th·ªùi gian website ng·ª´ng ho·∫°t ƒë·ªông khi g·∫∑p s·ª± c·ªë.
 * Y√™n t√¢m qu·∫£n tr·ªã: Gi√∫p b·∫°n t·ª± tin h∆°n khi th·ª±c hi·ªán c√°c thay ƒë·ªïi l·ªõn tr√™n website.
 * Linh ho·∫°t: C√≥ th·ªÉ l·ª±a ch·ªçn nhi·ªÅu ƒëi·ªÉm sao l∆∞u ƒë·ªÉ kh√¥i ph·ª•c.

ƒê√¢y l√† m·ªôt trong nh·ªØng t√≠nh nƒÉng quan tr·ªçng nh·∫•t c·ªßa WPTangToc OLS, gi√∫p b·∫£o v·ªá th√†nh qu·∫£ c√¥ng vi·ªác v√† ƒë·∫£m b·∫£o t√≠nh li√™n t·ª•c cho ho·∫°t ƒë·ªông tr·ª±c tuy·∫øn c·ªßa b·∫°n.
}


if [[ $1 = "" ]];then
. /etc/wptt/wptt-header-menu
header_menu
else
	. /etc/wptt/echo-color
echoDo "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
fi

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]];then
	ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

echo ""
echo ""
echo "$backup_restore:"
echo ""
options=(
	"$sao_luu_website"                                          #1
	"$khoi_phuc_website"                                        #2
	"$sao_luu_database"                                         #3
	"$khoi_phuc_database"                                       #4
	"$tu_dong_sao_luu_website"                                  #5
	"$tat_tu_dong_sao_luu_website"                              #6
	"$xoa_file_backup"                                          #7
	"$thiet_lap_backup_google_drive_rclone"                    #8
	"$download_tai_file_backup_tu_dam_may"                         #9
	"$huy_dang_ky_google_drive_hoac_onedrive"                                #10
	"$tu_dong_xoa_file_backup_het_han"                #13
	"$huy_tu_dong_xoa_file_backup_het_han"                      #14
	"$thiet_lap_tu_dong_xoa_file_backup_het_han_tren_dam_may"                      #15
	"$huy_thiet_lap_tu_dong_xoa_file_backup_het_han_tren_dam_may"                      #16
	"$xoa_file_backup_tren_luu_tru_dam_may"                      #18
	"$tu_dong_sao_luu_database"                      #19
	"$tat_tu_dong_sao_luu_database"                      #20
	"$thiet_lap_backup_microsoft_onedrive"                      #21
	"$sao_luu_website lu·ªπ ti·∫øn t·ª´ng ph·∫ßn"                      #21
	"$khoi_phuc_website lu·ªπ ti·∫øn t·ª´ng ph·∫ßn"                      #21
	"$chuyen_doi_dinh_dang_sao_luu_database"                      #17
	"Chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng n√©n m√£ ngu·ªìn sao l∆∞u"
)
# H√†m th·ª±c thi h√†nh ƒë·ªông d·ª±a tr√™n index (cho menu Backup & Restore)
run_action() {
    local index=$1
    local script_path=""
    local script_args="" # Tham s·ªë s·∫Ω ƒë∆∞·ª£c ƒë·∫∑t trong case

    case $index in
         0) script_path="/etc/wptt/backup-restore/wptt-saoluu";                         script_args="98" ;;
         1) script_path="/etc/wptt/backup-restore/wptt-khoiphuc";                       script_args="98" ;;
         2) script_path="/etc/wptt/db/wptt-saoluu-database";                            script_args="97" ;; # Ch√∫ √Ω: tham s·ªë 97
         3) script_path="/etc/wptt/db/wptt-nhapdatabase";                               script_args="97" ;; # Ch√∫ √Ω: tham s·ªë 97
         4) script_path="/etc/wptt/backup-restore/wptt-auto-backup";                    script_args="98" ;;
         5) script_path="/etc/wptt/backup-restore/wptt-tat-auto-backup";                script_args="98" ;;
         6) script_path="/etc/wptt/backup-restore/wptt-xoa-file-backup";                script_args="98" ;;
         7) script_path="/etc/wptt/backup-restore/wptt-rclone";                         script_args="98" ;; # Google Drive
         8) script_path="/etc/wptt/backup-restore/wptt-download-rclone";                script_args="98" ;;
         9) script_path="/etc/wptt/backup-restore/wptt-huy-rclone";                     script_args="98" ;;
        10) script_path="/etc/wptt/backup-restore/wptt-auto-delete-backup";             script_args="98" ;; # Local
        11) script_path="/etc/wptt/backup-restore/wptt-tat-delete-backup";              script_args="98" ;; # Local
        12) script_path="/etc/wptt/backup-restore/wptt-thiet-lap-auto-delete-google-driver-backup"; script_args="98" ;; # Cloud
        13) script_path="/etc/wptt/backup-restore/wptt-tat-auto-delete-backup-google-driver"; script_args="98" ;; # Cloud
        14) script_path="/etc/wptt/backup-restore/wptt-xoa-file-backup-google-driver";  script_args="98" ;; # Cloud
        15) script_path="/etc/wptt/backup-restore/wptt-auto-backup-database";           script_args="98" ;;
        16) script_path="/etc/wptt/backup-restore/wptt-tat-auto-backup-database";       script_args="98" ;;
        17) script_path="/etc/wptt/backup-restore/wptt-rclone-one-driver";              script_args="98" ;; # OneDrive
        18) script_path="/etc/wptt/backup-restore/wptt-saoluu-luy-tien-tung-phan";       script_args="98" ;;
        19) script_path="/etc/wptt/backup-restore/wptt-khoiphuc-luy-tien-tung-phan";              script_args="98" ;; # OneDrive
        20) script_path="/etc/wptt/backup-restore/wptt-sql-gzip-config";                script_args="98" ;;
        21) script_path="/etc/wptt/backup-restore/dinh-dang-backup-ma-nguon-option";              script_args="98" ;; # OneDrive
        *) echo "${lua_chon_khong_hop_le:-L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá}: Index $index."; return 1 ;;
    esac

    # Ki·ªÉm tra v√† ch·∫°y script con
    if [[ -x "$script_path" ]]; then
        # Ki·ªÉm tra xem script_args c√≥ ƒë∆∞·ª£c ƒë·∫∑t kh√¥ng (ƒë·ªÅ ph√≤ng l·ªói logic)
        if [[ -n "$script_args" ]]; then
            "$script_path" "$script_args"
        else
            echo "L·ªói logic: Kh√¥ng t√¨m th·∫•y tham s·ªë cho index $index."
        fi
    else
        echo "L·ªói: Kh√¥ng t√¨m th·∫•y ho·∫∑c kh√¥ng th·ªÉ th·ª±c thi script '$script_path'."
    fi
    # read -rp "Nh·∫•n Enter ƒë·ªÉ quay l·∫°i menu..." # B·ªè comment n·∫øu mu·ªën t·∫°m d·ª´ng
}

. /etc/wptt/wptt-callback-menu-chon

