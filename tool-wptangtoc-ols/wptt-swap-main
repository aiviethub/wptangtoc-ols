#!/bin/bash
# @author: Gia Tu·∫•n
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2025

function huong_dan(){
T√≠nh nƒÉng Qu·∫£n l√Ω swap Linux bao g·ªìm m·ªôt lo·∫°t c√°c h√†nh ƒë·ªông v√† c√¥ng c·ª• ƒë·ªÉ b·∫°n thi·∫øt l·∫≠p, ƒëi·ªÅu ch·ªânh, theo d√µi v√† g·ª° b·ªè kh√¥ng gian swap [b·ªô nh·ªõ ·∫£o] tr√™n h·ªá th·ªëng Linux c·ªßa m√¨nh. üß†‚öôÔ∏è

N√≥i m·ªôt c√°ch ƒë∆°n gi·∫£n, ƒë√¢y l√† vi·ªác b·∫°n ki·ªÉm so√°t to√†n b·ªô v√≤ng ƒë·ªùi c·ªßa RAM ·∫£o tr√™n ·ªï c·ª©ng: t·ª´ vi·ªác t·∫°o ra, cho n√≥ ho·∫°t ƒë·ªông, xem n√≥ ƒëang ƒë∆∞·ª£c d√πng bao nhi√™u, tinh ch·ªânh c√°ch n√≥ ƒë∆∞·ª£c d√πng, cho ƒë·∫øn khi kh√¥ng c·∫ßn n·ªØa th√¨ x√≥a ƒëi.

M·ª•c ƒê√≠ch C·ªßa Vi·ªác Qu·∫£n L√Ω Swap
 * ƒê·∫£m b·∫£o hi·ªáu su·∫•t h·ªá th·ªëng: Tr√°nh t√¨nh tr·∫°ng h·ªá th·ªëng qu√° ph·ª• thu·ªôc v√†o swap [v√¨ swap ch·∫≠m h∆°n RAM nhi·ªÅu], g√¢y √¨ ·∫°ch.
 * Duy tr√¨ s·ª± ·ªïn ƒë·ªãnh: Cung c·∫•p ƒë·ªß b·ªô nh·ªõ ·∫£o ƒë·ªÉ h·ªá th·ªëng kh√¥ng b·ªã l·ªói Out Of Memory khi t·∫£i n·∫∑ng.
 * T·ªëi ∆∞u h√≥a t√†i nguy√™n: S·ª≠ d·ª•ng kh√¥ng gian ƒëƒ©a v√† t√†i nguy√™n h·ªá th·ªëng m·ªôt c√°ch hi·ªáu qu·∫£.
 * Linh ho·∫°t ƒëi·ªÅu ch·ªânh: Thay ƒë·ªïi c·∫•u h√¨nh swap cho ph√π h·ª£p v·ªõi s·ª± thay ƒë·ªïi v·ªÅ ph·∫ßn c·ª©ng [v√≠ d·ª•: n√¢ng c·∫•p RAM] ho·∫∑c nhu c·∫ßu c√¥ng vi·ªác.
Qu·∫£n l√Ω swap hi·ªáu qu·∫£ gi√∫p c√¢n b·∫±ng gi·ªØa vi·ªác c√≥ ƒë·ªß b·ªô nh·ªõ ·∫£o ƒë·ªÉ h·ªá th·ªëng ·ªïn ƒë·ªãnh v√† vi·ªác tr√°nh l·∫°m d·ª•ng swap g√¢y ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu su·∫•t chung.
}

if [[ $1 = "" ]];then
. /etc/wptt/wptt-header-menu
header_menu
else
	. /etc/wptt/echo-color
echoDo "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
fi
echo ""
echo ""
echo ""
echo ""

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]];then
	ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

uswap=$(free -m | awk '/Swap/ {print $2}')
uswap_dang_dung=$(free -m | awk '/Swap/ {print $3}')
uswap_con_trong=$(free -m | awk '/Swap/ {print $4}')

echo "$dung_luong_swap_hien_tai: ${uswap}MB"
echo "$dung_luong_swap_dang_dung: ${uswap_dang_dung}MB"
echo "$dung_luong_swap_con_thua: ${uswap_con_trong}MB"
echo ""
echo "$quan_ly_swap:"
echo ""

options=(
    "$them swap" #1
    "$xoa swap"  #2
)

# H√†m th·ª±c thi h√†nh ƒë·ªông d·ª±a tr√™n index (cho menu Qu·∫£n l√Ω Swap)
run_action() {
    local index=$1
    local script_path=""
    local script_args="98" # Tham s·ªë 98 cho c√°c script n√†y

    case $index in
         0) script_path="/etc/wptt/swap/wptt-tao-swap" ;;
         1) script_path="/etc/wptt/swap/wptt-xoa-swap" ;;
        *) echo "${lua_chon_khong_hop_le:-L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá}: Index $index."; return 1 ;;
    esac

    # Ki·ªÉm tra v√† ch·∫°y script con
    if [[ -x "$script_path" ]]; then
        "$script_path" "$script_args"
    else
        echo "L·ªói: Kh√¥ng t√¨m th·∫•y ho·∫∑c kh√¥ng th·ªÉ th·ª±c thi script '$script_path'."
    fi
    # read -rp "Nh·∫•n Enter ƒë·ªÉ quay l·∫°i menu..." # B·ªè comment n·∫øu mu·ªën t·∫°m d·ª´ng
}
. /etc/wptt/wptt-callback-menu-chon

