#!/bin/bash
#
#
# @author: Gia Tuáº¥n
# @website: https://wptangtoc.com
# @since: 2021
echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Quan ly Logs => Ghi logs database                                      |"
echo "========================================================================="
echo ""
echo ""

check=$(cat /etc/my.cnf.d/server.cnf | grep -c "skip-log-bin")

if [[ "$check" = "0" ]];then
echo "Ban da kich hoat tinh nang ghi logs database"
sleep 3
. /etc/wptt/wptt-menu-logs
exit
fi

read -p "xac nhan xoa ghi logs database" dongy
if [[ "$dong" = "y" ]];then

echo "slow-query-log = 1
slow-query-log-file = /var/lib/mysql/mysql-slow.log
long_query_time = 1" >> /etc/my.cnf.d/server.cnf

sed -i '/skip-log-bin/d' /etc/my.cnf.d/server.cnf

systemctl restart mariadb.service

echo "========================================================================="
echo "Hoan tat kich hoat ghi logs database"
echo "========================================================================="
echo "File logs database                : /var/log/mysql/mysql-bin.log"
echo "File logs truy van cham database  : /var/lib/mysql/mysql-slow.log"
echo "========================================================================="
else
. /etc/wptt/wptt-menu-logs
fi
