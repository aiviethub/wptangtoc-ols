#!/bin/bash
read -p 'Nhập ip muốn proxy nguồn:' ip

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]];then
	ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

. /etc/wptt/tenmien
echo ""
echo ""
echo "Lựa chọn muốn proxy nguồn: "
echo ""
lua_chon_NAME

echo "
extprocessor ${NAME}proxy {
  type                    proxy
  address                 $ip:80
  maxConns                2000
  initTimeout             90
  retryTimeout            20
  respBuffer              0
}

" >> /usr/local/lsws/conf/httpd_config.conf

sed -i -e '/^context/,/^}$/d' /usr/local/lsws/conf/vhosts/$NAME/$NAME.conf

echo "
context / {
  type                    proxy
  handler                 ${NAME}proxy
  addDefaultCharset	  off
}" >> /usr/local/lsws/conf/vhosts/$NAME/$NAME.conf

/usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1

echo "Hoàn tất thiết lập proxy website $NAME về $ip"
