#!/bin/bash
# @author: Gia Tu·∫•n
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2025


function huong_dan(){
T√≠nh nƒÉng Qu·∫£n l√Ω T√†i nguy√™n trong WPTangToc OLS l√† m·ªôt c√¥ng c·ª• t√≠ch h·ª£p gi√∫p b·∫°n theo d√µi vi·ªác s·ª≠ d·ª•ng c√°c t√†i nguy√™n h·ªá th·ªëng quan tr·ªçng tr√™n m√°y ch·ªß c·ªßa m√¨nh. üìä‚öôÔ∏è

Gi·ªõi thi·ªáu ng·∫Øn g·ªçn:

M·ª•c ƒë√≠ch: Cung c·∫•p cho ng∆∞·ªùi d√πng c√°i nh√¨n t·ªïng quan v·ªÅ m·ª©c ƒë·ªô s·ª≠ d·ª•ng CPU, RAM [b·ªô nh·ªõ], v√† c√≥ th·ªÉ c·∫£ Disk I/O [ho·∫°t ƒë·ªông ƒë·ªçc/ghi c·ªßa ·ªï ƒëƒ©a] v√† Network I/O [l∆∞u l∆∞·ª£ng m·∫°ng] theo th·ªùi gian th·ª±c ho·∫∑c g·∫ßn th·ª±c. ƒêi·ªÅu n√†y gi√∫p x√°c ƒë·ªãnh c√°c ƒëi·ªÉm ngh·∫Ωn ti·ªÅm ·∫©n ho·∫∑c t√¨nh tr·∫°ng qu√° t·∫£i c·ªßa m√°y ch·ªß.

L·ª£i √≠ch:
 * Hi·ªÉu r√µ hi·ªáu su·∫•t m√°y ch·ªß: N·∫Øm b·∫Øt ƒë∆∞·ª£c t√¨nh tr·∫°ng s·ª©c kh·ªèe c·ªßa server.
 * Ch·∫©n ƒëo√°n s·ª± c·ªë: H·ªó tr·ª£ t√¨m ra nguy√™n nh√¢n g√¢y ch·∫≠m ho·∫∑c treo m√°y ch·ªß [v√≠ d·ª•: m·ªôt ti·∫øn tr√¨nh chi·∫øm qu√° nhi·ªÅu CPU/RAM].
 * T·ªëi ∆∞u h√≥a: Cung c·∫•p th√¥ng tin ƒë·ªÉ ƒë∆∞a ra quy·∫øt ƒë·ªãnh n√¢ng c·∫•p t√†i nguy√™n ho·∫∑c t·ªëi ∆∞u h√≥a ·ª©ng d·ª•ng/website.
 * S·ª≠ d·ª•ng thu·∫≠n ti·ªán: Truy c·∫≠p th√¥ng tin t√†i nguy√™n d·ªÖ d√†ng ngay trong WPTangToc OLS m√† kh√¥ng c·∫ßn nhi·ªÅu l·ªánh ph·ª©c t·∫°p.
T√≠nh nƒÉng n√†y gi√∫p b·∫°n ch·ªß ƒë·ªông h∆°n trong vi·ªác gi√°m s√°t v√† ƒë·∫£m b·∫£o m√°y ch·ªß lu√¥n ho·∫°t ƒë·ªông trong ƒëi·ªÅu ki·ªán t·ªët nh·∫•t.
}


if [[ $1 = "" ]];then
. /etc/wptt/wptt-header-menu
header_menu
else
	. /etc/wptt/echo-color
echoDo "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
fi

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]];then
	ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

# . /etc/wptt/python-check-version

echo ""
echo ""
echo "$quan_ly_tai_nguyen:"
echo ""
options=(
    "$kiem_tra $o_cung"                     #1
    "$kiem_tra $cong_nghe_ao_hoa"                      #2
    "$kiem_tra CPU"                  #3
    "$kiem_tra RAM"                #4
    "$kiem_tra $toc_do internet"                #5
    "$kiem_tra $toc_do internet ping ·ªïn ƒë·ªãnh"                #5
	"$xem system monitoring"                   #6
	"$xem system monitoring(TOP)"                   #6
	"$quan_ly_bang_thong"                   #6
)
# H√†m th·ª±c thi h√†nh ƒë·ªông d·ª±a tr√™n index (cho menu Qu·∫£n l√Ω t√†i nguy√™n)
# Gi·∫£ ƒë·ªãnh bi·∫øn $python_version ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong m√¥i tr∆∞·ªùng g·ªçi
run_action() {
    local index=$1
    local script_path=""
    local script_args=""      # Tham s·ªë s·∫Ω ƒë∆∞·ª£c ƒë·∫∑t trong case
    local command_prefix=""   # Ti·ªÅn t·ªë l·ªánh (v√≠ d·ª•: python)

    case $index in
         0) script_path="/etc/wptt/tai-nguyen-server/wptt-kiem-tra-disk";       script_args="98" ;;
         1) script_path="/etc/wptt/tai-nguyen-server/wptt-kiem-tra-ao-hoa-vps"; script_args="98" ;;
         2) script_path="/etc/wptt/tai-nguyen-server/wptt-kiem-tra-cpu";        script_args="98" ;;
         3) script_path="/etc/wptt/tai-nguyen-server/wptt-kiem-tra-ram";        script_args="98" ;;
         4) script_path="/etc/wptt/tai-nguyen-server/wptt-kiem-tra-mang-internet"; script_args="98" ;;
         5) script_path="/etc/wptt/tai-nguyen-server/wptt-kiem-tra-ping-internet"; script_args="98" ;;
         # 5) command_prefix="$python_version"; script_path="/etc/wptt/tai-nguyen-server/wptt-kiem-tra-ping-internet.py"; script_args="98" ;; # Python script
         6) script_path="/etc/wptt/logs/wptt-xem-tien-trinh";                   script_args="99" ;; # Ch√∫ √Ω: tham s·ªë 99
         7) script_path="/etc/wptt/tai-nguyen-server/wptt-top";                 script_args="98" ;;
         8) script_path="/etc/wptt/tai-nguyen-server/wptt-bang-thong-main";                 script_args="98" ;;
        *) echo "${lua_chon_khong_hop_le:-L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá}: Index $index."; return 1 ;;
    esac

    # Ki·ªÉm tra v√† ch·∫°y script con
    if [[ -n "$command_prefix" ]]; then
        # Th·ª±c thi l·ªánh v·ªõi ti·ªÅn t·ªë (v√≠ d·ª•: python script.py arg)
        if [[ -f "$script_path" ]]; then # Ki·ªÉm tra file t·ªìn t·∫°i cho python
             "$command_prefix" "$script_path" "$script_args"
        else
             echo "L·ªói: Kh√¥ng t√¨m th·∫•y t·ªáp script '$script_path'."
        fi
    elif [[ -n "$script_path" ]]; then
        # Th·ª±c thi script bash th√¥ng th∆∞·ªùng
        if [[ -x "$script_path" ]]; then
            # Ki·ªÉm tra xem script_args c√≥ ƒë∆∞·ª£c ƒë·∫∑t kh√¥ng
            if [[ -n "$script_args" ]]; then
                "$script_path" "$script_args"
            else
                "$script_path" # G·ªçi kh√¥ng c√≥ tham s·ªë n·∫øu script_args r·ªóng
            fi
        else
            echo "L·ªói: Kh√¥ng t√¨m th·∫•y ho·∫∑c kh√¥ng th·ªÉ th·ª±c thi script '$script_path'."
        fi
    else
         echo "L·ªói logic: Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c h√†nh ƒë·ªông cho index $index."
    fi

    # read -rp "Nh·∫•n Enter ƒë·ªÉ quay l·∫°i menu..." # B·ªè comment n·∫øu mu·ªën t·∫°m d·ª´ng
}
. /etc/wptt/wptt-callback-menu-chon

