#!/bin/bash

function huong_dan() {
  WPTangToc OLS c√≥ t√≠nh nƒÉng T·ªëi ∆∞u Heartbeat API, th√¨ ƒë√¢y l√† m·ªôt ch·ª©c nƒÉng gi√∫p b·∫°n ki·ªÉm so√°t v√† gi·∫£m thi·ªÉu t√°c ƒë·ªông c·ªßa WordPress Heartbeat API l√™n hi·ªáu su·∫•t m√°y ch·ªß.

  üéØ M·ª•c ƒë√≠ch c·ªßa t√≠nh nƒÉng t·ªëi ∆∞u:
  * Gi·∫£m t·∫£i CPU: H·∫°n ch·∫ø s·ªë l∆∞·ª£ng y√™u c·∫ßu AJAX ƒë∆∞·ª£c g·ª≠i ƒëi, gi√∫p gi·∫£m ƒë√°ng k·ªÉ vi·ªác s·ª≠ d·ª•ng CPU c·ªßa m√°y ch·ªß.
  * TƒÉng t·ªëc Admin: L√†m cho khu v·ª±c qu·∫£n tr·ªã WordPress ho·∫°t ƒë·ªông m∆∞·ª£t m√† v√† nhanh h∆°n.
  * NgƒÉn ch·∫∑n qu√° t·∫£i: Gi√∫p website ·ªïn ƒë·ªãnh h∆°n, ti·∫øt ki·ªám t√†i nguy√™n m√°y ch·ªß.

  ‚úÖ L·ª£i √≠ch:
  * C·∫£i thi·ªán hi·ªáu su·∫•t server.
  * TƒÉng t·ªëc ƒë·ªô backend WordPress.

  T√≥m l·∫°i: T√≠nh nƒÉng T·ªëi ∆∞u Heartbeat API trong WPTangToc OLS l√† m·ªôt c√¥ng c·ª• h·ªØu √≠ch gi√∫p b·∫°n ki·ªÉm so√°t c√°c y√™u c·∫ßu AJAX do WordPress t·∫°o ra, nh·∫±m gi·∫£m t·∫£i cho m√°y ch·ªß v√† tƒÉng t·ªëc ƒë·ªô khu v·ª±c qu·∫£n tr·ªã m·ªôt c√°ch hi·ªáu qu·∫£.

  link tham kh·∫£o chi ti·∫øt: https://wptangtoc.com/wordpress-heartbeat-api/
}

echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Qu·∫£n l√Ω WordPress => T·ªëi ∆∞u heartbeat API                              |"
echo "========================================================================="
. /etc/wptt/tenmien
echo ""
echo ""
echo "L·ª±a ch·ªçn website b·∫°n mu·ªën k√≠ch ho·∫°t t·ªëi ∆∞u Heartbeat API: "
echo ""
lua_chon_NAME

. /etc/wptt/echo-color
if [[ "$NAME" = "0" || "$NAME" = "" ]]; then
  . /etc/wptt/wptt-wordpress-main 1
fi

pathcheck="/etc/wptt/vhost/.$NAME.conf"
if [[ ! -f "$pathcheck" ]]; then
  clear
  echoDo "T√™n mi·ªÅn kh√¥ng t·ªìn t·∫°i tr√™n h·ªá th·ªëng n√†y"
  sleep 3
  . /etc/wptt/wptt-wordpress-main 1
  exit
fi

pathcheckwp="/usr/local/lsws/$NAME/html/wp-load.php"
if [[ ! -f "$pathcheckwp" ]]; then
  clear
  echoDo "H·ªá th·ªëng x√°c nh·∫≠n b·∫°n kh√¥ng s·ª≠ d·ª•ng WordPress"
  echoDo "T√≠nh nƒÉng n√†y ch·ªâc√≥ th·ªÉ ho·∫°t ƒë·ªông tr√™n WordPress"
  sleep 3
  . /etc/wptt/wptt-wordpress-main 1
  exit
fi

path="/etc/wptt/vhost/.$NAME.conf"

pathcheckplugin="/usr/local/lsws/$NAME/html/wp-content/plugins/heartbeat-wptangtoc"
if [[ -d "$pathcheckplugin" ]]; then
  echo "ban da toi uu heart api wordpress roi"
  . /etc/wptt/wptt-wordpress-main 1
fi

echo "B·∫°n c√≥ mu·ªën k√≠ch ho·∫°t t·ªëi ∆∞u heartbeat api "
prompt="Nh·∫≠p l·ª±a ch·ªçn c·ªßa b·∫°n [1-2]: "
check="n"
options=("ƒê·ªìng √Ω" "Kh√¥ng ƒë·ªìng √Ω")
PS3="$prompt"
select opt in "${options[@]}"; do
  case "$REPLY" in
  1)
    check="y"
    break
    ;;

  2)
    check="n"
    break
    ;;

  $((${#options[@]} + 1)))
    printf "\nB·∫°n nh·∫≠p sai h·ªá th·ªëng s·∫Ω ch·ªçn l√† kh√¥ng ƒë·ªìng √Ω\n"
    break
    ;;
  *)
    printf "B·∫°n nh·∫≠p sai h·ªá th·ªëng s·∫Ω ch·ªçn l√† kh√¥ng ƒë·ªìng √Ω\n"
    break
    ;;
  esac
done

if [[ "$check" = "y" ]]; then
  _runing "T·ªëi ∆∞u heartbeat API"
  . /etc/wptt/php/php-cli-domain-config $NAME
  /usr/local/lsws/lsphp${phien_ban_php_domain_thuc_thi}/bin/php /usr/local/bin/wp plugin install https://wptangtoc.com/share/heartbeat-wptangtoc.zip --path=/usr/local/lsws/$NAME/html --activate --allow-root
  . /etc/wptt/vhost/.$NAME.conf
  chown -R $User_name_vhost:$User_name_vhost /usr/local/lsws/$NAME/html/wp-content/plugins/heartbeat-wptangtoc
  _rundone "T·ªëi ∆∞u heartbeat API"
fi
check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]]; then
  . /etc/wptt/wptt-wordpress-main 1
fi
