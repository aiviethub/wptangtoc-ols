#!/bin/bash
# @author: Gia Tuấn
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2022
NAME=$1
if [[ $NAME = "" ]];then 
echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Reinstall WordPress		                              |"
echo "========================================================================="
. /etc/wptt/tenmien
echo ""
echo ""
echo "Lua chon website Reinstall WordPress: "
echo ""
lua_chon_NAME
fi


rm -rf /usr/local/lsws/$NAME/html/wp-admin
rm -rf /usr/local/lsws/$NAME/html/wp-includes

file=(
	bkv74.php
    xmlrpc.php
    wp-signup.php
    wp-login.php
    index.php
    license.txt
    readme.html
    wp-activate.php
    wp-blog-header.php
    wp-comments-post.php
    wp-config-sample.php
    wp-cron.php
    wp-links-opml.php
    wp-load.php
    wp-login.php
    wp-mail.php
    wp-settings.php
    wp-signup.php
    wp-trackback.php
    xmlrpc.php
	adminer.php
	xmlrpcs.php
	years.php
	bottom.php
	admin.php
	wjsindex.php
	votes.php
	lock666.php
	font-editor.php
	contents.php
	load.php
	themes.php
	settings.php
	bottom.php
	alwso.php
	service.php
	license.php
	log.txt
	goods.php
	wp-main.php
	damogkla.php
	jxcqeucl.php
	pdbnbeug.php
	upl.php
	sun.php
	zchnfbnt.php
	wp_mna.php
)

for deletefile in ${file[@]}; do
    rm -f /usr/local/lsws/$NAME/html/$deletefile
done


phien_ban_php_domain_check='74'
check_zip_php=$(/usr/local/lsws/lsphp${phien_ban_php_domain_check}/bin/php -m | grep 'zip')
if [[ $check_zip_php = '' ]];then
. /etc/wptt/php/install-php-zip "$phien_ban_php_domain_check" >/dev/null 2>&1
fi

wp core download --skip-content --force --allow-root --path=/usr/local/lsws/$NAME/html 2>/dev/null
wp core update-db --allow-root --path=/usr/local/lsws/$NAME/html 2>/dev/null
wp plugin install $(wp plugin list --field=name --allow-root --path=/usr/local/lsws/$NAME/html) --force --allow-root 2>/dev/null --path=/usr/local/lsws/$NAME/html
wp theme install $(wp theme list --field=name --path=/usr/local/lsws/$NAME/html --allow-root) --force --allow-root 2>/dev/null --path=/usr/local/lsws/$NAME/html
echo "Hoàn tất clean mã nguồn"



