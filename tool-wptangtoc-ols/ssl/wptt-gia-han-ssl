#!/bin/bash
# @author: Gia Tuấn
# @website: https://wptangtoc.com
# @since: 2022

echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Quản lý SSL => Gia hạn thủ công chứng chỉSSL FREE letsencrypt          |"
echo "========================================================================="
echo ""
echo ""
. /etc/wptt/echo-color

selects=()
for entry in $(ls -A /etc/wptt/vhost); do
	NAME=$(echo $entry | sed 's/^.//' | sed 's/.conf//')
	if [[ -f /etc/letsencrypt/live/$NAME/cert.pem ]]; then
			selects+=("$NAME")
	fi
done

if [[ $selects = '' ]];then
	echo "Tất cả domain trên hệ thống không có domain nào sử dụng SSL letsencrypt"
	. /etc/wptt/wptt-ssl-main 1
fi


read -p "Bạn muốn gia hạn chứng chỉssl Free letsencrypt? (y/n): " renew
if [[ "$renew" = "y" ]]; then
	. /etc/wptt/echo-color
	_runing "Gia hạn chứng chỉ SSL Free letsencrypt"
    /usr/bin/certbot renew --quiet
    /usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
	_rundone "Gia hạn chứng chỉ SSL Free letsencrypt"
fi

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]];then
. /etc/wptt/wptt-ssl-main 1
fi


