#!/bin/bash
# @author: Gia Tuấn
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2025

function huong_dan() {
WPTangToc OLS nay cho phép bạn lựa chọn định dạng nén mã nguồn khi sao lưu, giúp tối ưu hóa giữa tốc độ và sự tiện lợi.

ZSTD [.tar.zst]: Lựa chọn hiệu suất cao. Nén và giải nén cực nhanh, tốn ít CPU và tạo file backup nhỏ gọn hơn.

Khuyên dùng: Cho các tác vụ tự động trên máy chủ để tiết kiệm thời gian và dung lượng.
ZIP [.zip]: Lựa chọn tương thích tối đa. File .zip có thể mở được trên mọi máy tính [Windows, macOS] mà không cần cài đặt thêm phần mềm.

Khuyên dùng: Khi bạn cần tải file backup về máy cá nhân hoặc chia sẻ cho người khác.

Mặc định thiết lập là: .zip
}

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]]; then
  ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

. /etc/wptt/.wptt.conf
. /etc/wptt/echo-color
unset dinh_dang_nen_ma_nguon
prompt="$nhap_lua_chon_cua_ban [1-2] [0=$exit_thoat] : "
options=(".zip" ".tar.zst")
PS3="$prompt"
select opt in "${options[@]}"; do
  case "$REPLY" in
  1)
    dinh_dang_nen_ma_nguon="no"
    break
    ;;

  2)
    dinh_dang_nen_ma_nguon="1"
    break
    ;;

  $((${#options[@]} + 1)))
    printf "hệ thống sẽ thoát\n"
    break
    ;;
  *)
    printf "hệ thống sẽ thoát\n"
    break
    ;;
  esac
done

if [[ $dinh_dang_nen_ma_nguon = '' || $dinh_dang_nen_ma_nguon = '0' ]]; then
  . /etc/wptt/wptt-backup-restore-main 1
fi

if [[ $dinh_dang_nen_ma_nguon = '1' ]]; then
  print_dinh_dang_db='.tar.zst'
  if [[ $(which zstd 2>/dev/null) = '' ]]; then # cai zstd
    dnf install zstd -y
  fi
else
  print_dinh_dang_db='.zip'
fi

_runing "config chuyển định dạng sao lưu mã nguồn sang $print_dinh_dang_db"

sed -i '/dinh_dang_nen_ma_nguon/d' /etc/wptt/.wptt.conf
if [[ $dinh_dang_nen_ma_nguon != 'no' ]]; then
  echo "dinh_dang_nen_ma_nguon=$dinh_dang_nen_ma_nguon" >>/etc/wptt/.wptt.conf
fi

echo "config chuyển định dạng sao lưu mã nguồn $print_dinh_dang_db: $(date '+%d-%m-%Y %H:%M')" >>/var/log/wptangtoc-ols.log

_rundone "config chuyển định dạng sao lưu mã nguồn sang $print_dinh_dang_db"

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]]; then
  . /etc/wptt/wptt-backup-restore-main 1
fi


