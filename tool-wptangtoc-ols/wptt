#!/bin/bash
#
#
# @author: Gia Tuáº¥n
# @website: https://wptangtoc.com
# @since: 2021


function reboot-ls(){
/usr/local/lsws/bin/lswsctrl restart
echo "Hoan tat reboot lai LiteSpeed Webserver"
}

function reboot-db(){
systemctl restart mariadb.service
echo "-------------------------------------------------------------------------"
echo "Hoan thanh reboot Maria Database"
echo "-------------------------------------------------------------------------"
echo "Tinh trang hoat dong Maria Database hien tai"
echo "MariaDB       : $(systemctl status mariadb.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)"
echo "-------------------------------------------------------------------------"
}

function reboot-all(){
echo "Dang thuc hien reboot service Litespeed, Mysql, SSH, fail2ban, crond, LSMemcached."
systemctl restart lsmcd
/usr/local/lsws/bin/lswsctrl restart >/dev/null 2>&1
systemctl restart mariadb.service
systemctl restart sshd.service
systemctl restart crond.service
systemctl restart fail2ban
echo "Hoan thanh reboot service Litespeed, Mysql, SSH, fail2ban, crond, LSMemcached."
echo "+-----------------------------------------------------------------------+"
echo "|Tinh trang hoat dong cac service hien tai                              |"
echo "+-----------------------------------------------------------------------+"
echo "|LiteSpeed     : $(systemctl status lshttpd.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
echo "|MariaDB       : $(systemctl status mariadb.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
echo "|LSMemcached   : $(systemctl status lsmcd.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
echo "|SSH           : $(systemctl status sshd.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
echo "|Crond         : $(systemctl status crond.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
echo "|Fail2Ban      : $(systemctl status fail2ban.service | grep 'Active' | cut -f2 -d':' | xargs | cut -f1 -d' ' | xargs)                                                 |"
echo "+-----------------------------------------------------------------------+"
}

function ip(){
ip=$(curl -s myip.directadmin.com)
if [[ "$ip" = "" ]]; then
    ip=$(curl -s ifconfig.me)
fi
echo "IP hien tai cua webserver la: $ip"
}

function dns-check(){
ip=$(curl -s myip.directadmin.com)
if [[ "$ip" = "" ]]; then
    ip=$(curl -s ifconfig.me)
fi
$NAME=$2

if [ "$NAME" = "${NAME/./}" ]; then
  clear
  echo "Domain ten mien nhap khong dung dinh dang."
  exit
fi

checkdns=$(host $NAME | grep -Eo -m 1 '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}')
if [[ "$checkdns" = "" ]]; then
    checkdns=$(nslookup $NAME | grep Address | cut -f5 | grep -Eo -m 1 '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}')
fi

if [[ "$checkdns" != "$ip" ]]; then
    echo "Ban chua tro ten mien dns ve webhost ip: $ip moi"
    echo "Hay tro dns thi moi co the cai duoc ssl"
    echo "Hay tro DNS $checkdns thanh $ip roi quay lai cai ssl nhe"
    if [[ "$checkdns" = "" ]]; then
        echo "Ten mien $NAME chua duoc tro IP gia tri IP cua $NAME la khong co gia tri nao, ban vui long tro IP ve $ip"
    fi
    echo "Ten mien $NAME dang duoc su dung quan ly boi $checknameserver ban hay truy cap vao do de tro ten mien cua minh"
    else
    echo "domain $NAME da tro dns ve may chu cua ban ($ip)"
fi
}

$1
