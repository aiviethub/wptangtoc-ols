#!/bin/bash

. /etc/wptt/echo-color

NAME=$1
if [[ $NAME = "98" ]];then
NAME=""
fi

if [[ "$NAME" = "" ]]; then
    . /etc/wptt/tenmien
    echo ""
    echo ""
    echo "Lua chon website muon chuyen doi htaccess sang vhosts: "
    echo ""
    lua_chon_NAME
fi

if [[ $NAME = "0" || $NAME = '' ]];then
exit
fi

path="/etc/wptt/vhost/.$NAME.conf"
if [[ ! -f "$path" ]]; then
    clear
    echoDo "Domain khong ton tai tren VPS."
    exit
fi


pathcheckwp="/usr/local/lsws/$NAME/html/wp-load.php"
if [[ ! -f "$pathcheckwp" ]]; then
  clear
  echoDo "He thong xac nhan ban chua kich hoat su dung WordPress"
  sleep 3
  exit
fi

if [[ ! -f /usr/local/lsws/$NAME/html/.htaccess ]];then
echoDo "Khong xac dinh duoc .htaccess cua website $NAME"
exit
fi

check_config_vhost=$(cat /usr/local/lsws/conf/vhosts/$NAME.conf | grep '#chuyen-doi-htaccess')

if [[ $check_config_vhost ]];then
sed -i '/#chuyen-doi-htaccess/,$d' /usr/local/lsws/conf/vhosts/$NAME.conf
else
sed -i '/^rewrite/,+4d' /usr/local/lsws/conf/vhosts/$NAME.conf
fi



lenh_htaccess=$(cat /usr/local/lsws/$NAME/html/.htaccess)

echo "#chuyen-doi-htaccess
rewrite  {
  enable                  1
  autoLoadHtaccess        0
  $lenh_htaccess
}" >> /usr/local/lsws/conf/vhosts/$NAME.conf

wptt reboot-ls
echo "Hoan tat chuyen doi .htaccess sang vhost va tat .htaccess"
