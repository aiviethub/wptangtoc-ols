#!/bin/bash
function huong_dan(){
T√≠nh nƒÉng n√†y ch·ªâ chuy·ªÉn t·ª´ server ngu·ªìn ƒëang d√πng [wptangtoc ols] sang h·ªá th·ªëng ƒë√≠ch c≈©ng ƒëang wptantoc ols
B·∫°n th·ª±c thi menu server ngu·ªìn b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng t√≠nh nƒÉng

T√≠nh nƒÉng Qu·∫£n l√Ω Chuy·ªÉn to√†n b·ªô Website [ALL Website Migration] trong WPTangToc OLS l√† m·ªôt t·∫≠p h·ª£p c√°c c√¥ng c·ª• v√† quy tr√¨nh ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ gi√∫p b·∫°n di chuy·ªÉn to√†n b·ªô website [ƒë·∫∑c bi·ªát l√† WordPress] t·ª´ m·ªôt n∆°i n√†y sang h·ªá th·ªëng c≈©ng d√πng wptantoc ols m·ªôt c√°ch d·ªÖ d√†ng v√† √≠t l·ªói h∆°n. üööüí®

Gi·ªõi thi·ªáu ng·∫Øn g·ªçn:
M·ª•c ƒë√≠ch: ƒê∆°n gi·∫£n h√≥a qu√° tr√¨nh chuy·ªÉn website gi·ªØa c√°c m√°y ch·ªß, t·ª´ nh√† cung c·∫•p n√†y sang nh√† cung c·∫•p kh√°c v√† ng∆∞·ª£c l·∫°i [Y√™u c·∫ßu c·∫£ 2 h·ªá th·ªëng c√πng d√πng wptangtoc ols].

L·ª£i √≠ch:
 * Gi·∫£m thi·ªÉu l·ªói th·ªß c√¥ng: T·ª± ƒë·ªông h√≥a nhi·ªÅu b∆∞·ªõc ph·ª©c t·∫°p trong qu√° tr√¨nh di chuy·ªÉn.
 * Ti·∫øt ki·ªám th·ªùi gian: TƒÉng t·ªëc ƒë·ªô di chuy·ªÉn website so v·ªõi vi·ªác l√†m th·ªß c√¥ng ho√†n to√†n.
 * ƒê·∫£m b·∫£o t√≠nh to√†n v·∫πn: Gi√∫p di chuy·ªÉn ƒë·∫ßy ƒë·ªß c·∫£ t·ªáp tin v√† c∆° s·ªü d·ªØ li·ªáu m·ªôt c√°ch nh·∫•t qu√°n.
 * Thu·∫≠n ti·ªán: Cung c·∫•p m·ªôt quy tr√¨nh t√≠ch h·ª£p ngay trong c√¥ng c·ª• qu·∫£n l√Ω m√°y ch·ªß quen thu·ªôc.
T√≠nh nƒÉng n√†y gi√∫p qu√° tr√¨nh chuy·ªÉn nh√† cho website c·ªßa b·∫°n tr·ªü n√™n m∆∞·ª£t m√† v√† √≠t cƒÉng th·∫≥ng h∆°n, ƒë·∫£m b·∫£o website ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh tr√™n m√¥i tr∆∞·ªùng m·ªõi.
}

echo ""
echo ""
echo ""
echo "========================================================================="
echo "|$chuyen_tat_ca_website_wptangtoc_ve_wptangtoc_ols	                  |"
echo "========================================================================="
echo "Ghi ch√∫: T√≠nh nƒÉng n√†y ch·ªâ h·ªó tr·ª£ chuy·ªÉn t·ª´ wptangtoc ols qua wptantoc ols v·ªõi nhau"
echo "D√°n paste ƒëo·∫°n l·ªánh n√†y v√†o terminal SSH webserver c≈© c·ªßa b·∫°n ƒë·ªÉ sao l∆∞u to√†n b·ªô b√™n h·ªá th·ªëng c≈©: "
echo ""
read -p "X√°c nh·∫≠n ƒë√£ ho√†n t·∫•t ch·∫°y l·ªánh tr√™n sao l∆∞u d·ªØ li·ªáu b√™n webserver c≈© v√† ti·∫øp t·ª•c ch·∫°y (y/n): " dongy

. /etc/wptt/.wptt.conf

read -p "Nh·∫≠p t√™n domain website chinh: " domain_download_list
cd
rm -f danh-sach-website-wptangtoc-ols.txt
wget http://$domain_download_list/danh-sach-website-wptangtoc-ols.txt --no-check-certificate

if [[ ! -f danh-sach-website-wptangtoc-ols.txt ]];then
echo "Xac nhan khong nhap vps chinh cu khong chinh xac"
return 2>/dev/null ; exit
fi

domain_them=($(cat danh-sach-website-wptangtoc-ols.txt))

domain_trung_lap=($(ls -A /etc/wptt/vhost | sed 's/^.//' | sed 's/.conf//'))

  echo '--------------------------------------------------'
  for NAME in ${domain_them[@]}; do
	  echo "Tien hanh chuyen website $NAME"
	  sleep 3
	if [[ ! "${domain_trung_lap[@]}" =~ "${NAME}" ]];then
		echo "Them domain $NAME vao WPTangToc OLS"
		. /etc/wptt/domain/wptt-themwebsite $NAME
	fi
		. /etc/wptt/chuyen-web/wptt-chuyen-website $NAME 1
		echo "Chuyen Hoan tat website $NAME"
  done
  echo '--------------------------------------------------'

cd && rm -f danh-sach-website-wptangtoc-ols.txt
  for NAME in ${domain_them[@]}; do
	  rm -f /usr/local/lsws/$NAME/html/danh-sach-website-wptangtoc-ols.txt
	  rm -f /usr/local/lsws/$NAME/html/wptt-all
  done
  echo '--------------------------------------------------'
. /etc/wptt/domain/wptt-list-domain
echo "Ho√†n t·∫•t chuy·ªÉn to√†n b·ªô website v√†o VPS m·ªõi"
ip=$(curl -skf --connect-timeout 5 --max-time 10 https://ipv4.icanhazip.com |grep -E -o '(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)' || curl -skf --connect-timeout 5 --max-time 10 https://checkip.amazonaws.com| grep -E -o '(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)')
echo "Hay tro ip cac website ve IP: $ip va tien hanh cai dat ssl de su dung"
