#!/bin/bash
# @author: Gia Tu·∫•n
# @since: 2025



function huong_dan(){
T√≠nh nƒÉng Qu·∫£n l√Ω SSH trong WPTangToc OLS l√† m·ªôt c√¥ng c·ª• gi√∫p b·∫°n c·∫•u h√¨nh v√† tƒÉng c∆∞·ªùng b·∫£o m·∫≠t cho d·ªãch v·ª• SSH [Secure Shell] tr√™n m√°y ch·ªß c·ªßa m√¨nh m·ªôt c√°ch thu·∫≠n ti·ªán. üîê

Gi·ªõi thi·ªáu ng·∫Øn g·ªçn:

M·ª•c ƒë√≠ch: ƒê∆°n gi·∫£n h√≥a vi·ªác thay ƒë·ªïi c√°c c√†i ƒë·∫∑t SSH ph·ªï bi·∫øn ƒë·ªÉ b·∫£o v·ªá m√°y ch·ªß kh·ªèi c√°c truy c·∫≠p tr√°i ph√©p v√† l√†m cho vi·ªác qu·∫£n tr·ªã qua SSH an to√†n h∆°n.
C√°ch ho·∫°t ƒë·ªông:
 * Thay ƒë·ªïi c·ªïng SSH: ƒê·ªïi c·ªïng SSH m·∫∑c ƒë·ªãnh [22] sang m·ªôt c·ªïng kh√°c ƒë·ªÉ gi·∫£m thi·ªÉu c√°c cu·ªôc t·∫•n c√¥ng t·ª± ƒë·ªông.
 * T·∫Øt/B·∫≠t ƒëƒÉng nh·∫≠p c·ªßa root: V√¥ hi·ªáu h√≥a quy·ªÅn ƒëƒÉng nh·∫≠p tr·ª±c ti·∫øp c·ªßa ng∆∞·ªùi d√πng root qua SSH.
 * Thay ƒë·ªïi m·∫≠t kh·∫©u username.
 * v.v.v

L·ª£i √≠ch:
 * N√¢ng cao b·∫£o m·∫≠t: Gi·∫£m b·ªÅ m·∫∑t t·∫•n c√¥ng cho m√°y ch·ªß.
 * Qu·∫£n l√Ω ti·ªán l·ª£i: D·ªÖ d√†ng th·ª±c hi·ªán c√°c thay ƒë·ªïi c·∫•u h√¨nh SSH quan tr·ªçng m√† kh√¥ng c·∫ßn s·ª≠a file th·ªß c√¥ng.
 * Tu√¢n th·ªß th·ª±c h√†nh t·ªët nh·∫•t: H·ªó tr·ª£ ng∆∞·ªùi d√πng √°p d·ª•ng c√°c khuy·∫øn ngh·ªã b·∫£o m·∫≠t cho SSH.

T√≠nh nƒÉng n√†y gi√∫p b·∫°n c·ªßng c·ªë m·ªôt trong nh·ªØng c·ª≠a ng√µ quan tr·ªçng nh·∫•t v√†o m√°y ch·ªß c·ªßa m√¨nh, ƒë·∫£m b·∫£o an to√†n cho h·ªá th·ªëng.
}


if [[ $1 = "" ]];then
. /etc/wptt/wptt-header-menu
header_menu
else
	. /etc/wptt/echo-color
echoDo "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
fi

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]];then
	ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh


# --- ƒê·ªãnh nghƒ©a Menu v√† H√†nh ƒë·ªông ---
echo ""
echo ""
echo "$quan_ly_ssh:" #s·ª≠ d·ª•ng echo ƒë·∫ßu v√† cƒÉn l·ªÅ bi·∫øn ƒë·ªÉ s·ª≠ d·ª•ng fzf search all
echo ""
options=(
    "$thay_doi_password_ssh"                     # Index 0
    "$thay_doi_port_ssh"                         # Index 1
    "$thiet_lap_canh_bao_login_ssh_qua_telegram" # Index 2
    "$bat_tat_dang_nhap_username_rieng_domain"   # Index 3
    "${thoi_gian_timeout_ssh:-Thay ƒë·ªïi th·ªùi gian timeout ssh}" # Index 4 - D√πng bi·∫øn m·ªõi ho·∫∑c m·∫∑c ƒë·ªãnh
)

# H√†m th·ª±c thi h√†nh ƒë·ªông d·ª±a tr√™n index
run_action() {
    local index=$1
    local script_path=""
    local script_args="98" # Tham s·ªë m·∫∑c ƒë·ªãnh l√† 98 cho h·∫ßu h·∫øt c√°c script n√†y

    case $index in
        0) script_path="/etc/wptt/ssh/wptt-passwd" ;;
        1) script_path="/etc/wptt/ssh/wptt-ssh-port" ;;
        2) script_path="/etc/wptt/bao-mat/thong-bao-login-ssh" ;;
        3) script_path="/etc/wptt/domain/wptt-khoi-tao-user" ;;
        4) script_path="/etc/wptt/ssh/wptt-set-timeout-ssh" ;;
        *) echo "${lua_chon_khong_hop_le:-L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá}: Index $index."; return 1 ;;
    esac

    # Ki·ªÉm tra v√† ch·∫°y script con
    if [[ -x "$script_path" ]]; then
        "$script_path" "$script_args"
    else
        echo "L·ªói: Kh√¥ng t√¨m th·∫•y ho·∫∑c kh√¥ng th·ªÉ th·ª±c thi script '$script_path'."
    fi
    # Sau khi ch·∫°y xong, c√≥ th·ªÉ th√™m "Nh·∫•n Enter ƒë·ªÉ ti·∫øp t·ª•c" n·∫øu mu·ªën
    # read -rp "Nh·∫•n Enter ƒë·ªÉ quay l·∫°i menu..."
}

. /etc/wptt/wptt-callback-menu-chon

