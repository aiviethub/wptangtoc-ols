#!/bin/bash
# @author: Gia Tu·∫•n
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2025

function huong_dan() {
  T√≠nh nƒÉng qu·∫£n l√Ω CSF [ConfigServer Security &
  Firewall] trong WPTangToc OLS l√† m·ªôt c√¥ng c·ª• t√≠ch h·ª£p gi√∫p b·∫°n d·ªÖ d√†ng c√†i ƒë·∫∑t, c·∫•u h√¨nh v√† ƒëi·ªÅu khi·ªÉn firewall CSF ngay t·ª´ giao di·ªán ho·∫∑c d√≤ng l·ªánh c·ªßa WPTangToc OLS. üõ°Ô∏è

  N√≥ ƒë∆°n gi·∫£n h√≥a vi·ªác b·∫£o v·ªá m√°y ch·ªß c·ªßa b·∫°n b·∫±ng c√°ch cho ph√©p th·ª±c hi·ªán nhanh c√°c t√°c v·ª• nh∆∞:

  * C√†i ƒë·∫∑t v√† g·ª° b·ªè CSF: Tri·ªÉn khai ho·∫∑c lo·∫°i b·ªè firewall m·ªôt c√°ch thu·∫≠n ti·ªán.
  * Qu·∫£n l√Ω quy t·∫Øc IP: D·ªÖ d√†ng cho ph√©p [allow], ch·∫∑n [deny/block], ho·∫∑c b·ªè ch·∫∑n [unblock] c√°c ƒë·ªãa ch·ªâ IP, ch·∫∑n IP theo qu·ªëc gia...
  * M·ªü/ƒê√≥ng c·ªïng [Ports]: C·∫•u h√¨nh c√°c c·ªïng ƒë∆∞·ª£c ph√©p ho·∫∑c b·ªã ch·∫∑n tr√™n m√°y ch·ªß.
  * Ki·ªÉm so√°t d·ªãch v·ª• CSF: Kh·ªüi ƒë·ªông, d·ª´ng, ho·∫∑c kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª• firewall.
  * Xem tr·∫°ng th√°i v√† logs: Nhanh ch√≥ng ki·ªÉm tra t√¨nh tr·∫°ng ho·∫°t ƒë·ªông c·ªßa firewall v√† xem nh·∫≠t k√Ω li√™n quan.
  * v.v.v
  V·ªÅ c∆° b·∫£n, t√≠nh nƒÉng n√†y gi√∫p b·∫°n qu·∫£n l√Ω m·ªôt trong nh·ªØng firewall m·∫°nh m·∫Ω v√† ph·ªï bi·∫øn cho Linux m·ªôt c√°ch tr·ª±c quan v√† hi·ªáu qu·∫£ h∆°n, tƒÉng c∆∞·ªùng an ninh cho m√°y ch·ªß c·ªßa b·∫°n.
}

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]]; then
  ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

if [[ $1 = "" ]]; then
  . /etc/wptt/wptt-header-menu
  header_menu
else
  . /etc/wptt/echo-color
  echoDo "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
fi
echo ""
echo ""
echo "$quan_ly_csf:"
echo ""
options=(
  "$kich_hoat_webguiadmin CSF"                                     #0
  "$huy_kich_hoat_webguiadmin CSF"                                 #1
  "Ch·∫∑n qu·ªëc gia"                                                  #2
  "Ch·ªâ cho ph√©p m·ªôt s·ªë qu·ªëc gia ƒë∆∞·ª£c truy c·∫≠p"                     #3
  "H·ªßy b·ªè ch·∫∑n qu·ªëc gia"                                           #4
  "H·ªßy b·ªè ch·∫∑n to√†n b·ªô qu·ªëc gia ch·ªâ ƒë∆∞·ª£c m·ªôt s·ªë qu·ªëc gia cho ph√©p" #5
  "B·∫≠t ch·∫ø ƒë·ªô ch·ªëng DDOS"                                          #6
  "T·∫Øt ch·∫ø ƒë·ªô ch·ªëng DDOS"                                          #7
)

# H√†m th·ª±c thi h√†nh ƒë·ªông d·ª±a tr√™n index (cho menu Qu·∫£n l√Ω CSF)
run_action() {
  local index=$1
  local script_path=""
  local script_args="98" # Tham s·ªë 98 cho c√°c script n√†y

  case $index in
  0) script_path="/etc/wptt/bao-mat/csf/wptt-cai-dat-csf" ;;
  1) script_path="/etc/wptt/bao-mat/csf/wptt-huy-cai-dat-csf" ;;
  2) script_path="/etc/wptt/bao-mat/csf/chan-ip-quoc-gia" ;;
  3) script_path="/etc/wptt/bao-mat/csf/chan-ip-quoc-gia-chi-cho-phep" ;;
  4) script_path="/etc/wptt/bao-mat/csf/huy-bo-chan-ip-quoc-gia" ;;
  5) script_path="/etc/wptt/bao-mat/csf/huy-bo-chan-ip-quoc-gia-chi-cho-phep" ;;
  6) script_path="/etc/wptt/bao-mat/csf/mod-csf-chong-ddos" ;;
  7) script_path="/etc/wptt/bao-mat/csf/tat-mod-csf-chong-ddos" ;;
  *)
    echo "${lua_chon_khong_hop_le:-L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá}: Index $index."
    return 1
    ;;
  esac

  # Ki·ªÉm tra v√† ch·∫°y script con
  if [[ -x "$script_path" ]]; then
    "$script_path" "$script_args"
  else
    echo "L·ªói: Kh√¥ng t√¨m th·∫•y ho·∫∑c kh√¥ng th·ªÉ th·ª±c thi script '$script_path'."
  fi
  # read -rp "Nh·∫•n Enter ƒë·ªÉ quay l·∫°i menu..." # B·ªè comment n·∫øu mu·ªën t·∫°m d·ª´ng
}
. /etc/wptt/wptt-callback-menu-chon
