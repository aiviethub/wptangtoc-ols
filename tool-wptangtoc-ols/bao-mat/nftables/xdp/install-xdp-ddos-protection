#!/bin/bash

# Cài đặt bộ công cụ phát triển, Clang, LLVM, và các thư viện cần thiết
check_xdp_action=$(ip a | grep 'xdp')
if [[ $check_xdp_action ]]; then
  echo "đã kích hoạt"
  exit
fi
sudo dnf groupinstall -y "Development Tools"
sudo dnf config-manager --set-enabled powertools
sudo dnf install -y clang llvm kernel-devel-$(uname -r) iproute bpftool elfutils-libelf-devel

sudo dnf install libbpf-devel -y

cd /etc/wptt/bao-mat/nftables/xdp
rm -f xdp_ddos_protection.o
clang -O2 -g -target bpf -c xdp_ddos_protection.c -o xdp_ddos_protection.o
ip link set dev eth0 xdp obj xdp_ddos_protection.o sec xdp
check=$(ip link show eth0 | grep 'xdp')
if [[ $check ]]; then
  echo "Hoàn tất"
else
  echo "không thành công"
fi
