#!/bin/bash

function huong_dan() {
  T√≠nh nƒÉng Qu·∫£n l√Ω M·ªü Kh√≥a IP / Kh√≥a IP trong WPTangToc OLS l√† m·ªôt c√¥ng c·ª• gi√∫p b·∫°n d·ªÖ d√†ng ki·ªÉm so√°t vi·ªác cho ph√©p ho·∫∑c ch·∫∑n c√°c ƒë·ªãa ch·ªâ IP c·ª• th·ªÉ truy c·∫≠p v√†o m√°y ch·ªß c·ªßa m√¨nh, th∆∞·ªùng th√¥ng qua vi·ªác t∆∞∆°ng t√°c v·ªõi firewall. üö´‚úÖ

  Gi·ªõi thi·ªáu ng·∫Øn g·ªçn:
  M·ª•c ƒë√≠ch: N√¢ng cao b·∫£o m·∫≠t m√°y ch·ªß b·∫±ng c√°ch cho ph√©p b·∫°n nhanh ch√≥ng ch·∫∑n c√°c ƒë·ªãa ch·ªâ IP ƒë√°ng ng·ªù, c√≥ h√†nh vi t·∫•n c√¥ng, ho·∫∑c b·ªè ch·∫∑n c√°c IP b·ªã kh√≥a nh·∫ßm.
  C√°ch ho·∫°t ƒë·ªông:
  * Kh√≥a IP [Block IP]: Th√™m m·ªôt ho·∫∑c nhi·ªÅu ƒë·ªãa ch·ªâ IP v√†o danh s√°ch b·ªã ch·∫∑n c·ªßa firewall.
  * M·ªü Kh√≥a IP [Unblock IP]: G·ª° b·ªè m·ªôt ƒë·ªãa ch·ªâ IP kh·ªèi danh s√°ch b·ªã ch·∫∑n.
  * Ki·ªÉm tra IP [c√≥ th·ªÉ]: Xem m·ªôt IP c·ª• th·ªÉ c√≥ ƒëang b·ªã ch·∫∑n hay kh√¥ng.
  L·ª£i √≠ch:
  * Ph·∫£n ·ª©ng nhanh v·ªõi m·ªëi ƒëe d·ªça: Nhanh ch√≥ng ch·∫∑n c√°c IP t·∫•n c√¥ng ho·∫∑c spam.
  * Ki·ªÉm so√°t truy c·∫≠p linh ho·∫°t: D·ªÖ d√†ng qu·∫£n l√Ω quy·ªÅn truy c·∫≠p cho c√°c IP c·ª• th·ªÉ.
  * ƒê∆°n gi·∫£n h√≥a thao t√°c firewall: Th·ª±c hi·ªán c√°c t√°c v·ª• ch·∫∑n/m·ªü IP m√† kh√¥ng c·∫ßn s·ª≠ d·ª•ng c√°c l·ªánh firewall ph·ª©c t·∫°p.
  * B·∫£o v·ªá m√°y ch·ªß: Gi·∫£m thi·ªÉu nguy c∆° t·ª´ c√°c truy c·∫≠p kh√¥ng mong mu·ªën ho·∫∑c ƒë·ªôc h·∫°i.
  T√≠nh nƒÉng n√†y l√† m·ªôt ph·∫ßn quan tr·ªçng c·ªßa vi·ªác qu·∫£n tr·ªã b·∫£o m·∫≠t m√°y ch·ªß, gi√∫p b·∫°n duy tr√¨ m·ªôt m√¥i tr∆∞·ªùng an to√†n h∆°n cho website c·ªßa m√¨nh.

}

if [[ $1 = "" ]]; then
  . /etc/wptt/wptt-header-menu
  header_menu
else
  . /etc/wptt/echo-color
  echoDo "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
fi

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]]; then
  ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

echo ""
echo ""
echo "$quan_ly_ip:"
echo ""
options=(
  "$khoa_ip"                 #1
  "$mo_khoa_ip"              #2
  "$danh_sach_ip_da_bi_khoa" #3
  "$mo_khoa_ip t·∫•t c·∫£"       #4
)
# H√†m th·ª±c thi h√†nh ƒë·ªông d·ª±a tr√™n index (cho menu Qu·∫£n l√Ω IP)
run_action() {
  local index=$1
  local script_path=""
  local script_args="98" # Tham s·ªë 98 cho c√°c script n√†y

  case $index in
  0) script_path="/etc/wptt/fail2ban/wptt-khoa-ip" ;;
  1) script_path="/etc/wptt/fail2ban/wptt-mokhoaip" ;;
  2) script_path="/etc/wptt/fail2ban/wptt-list" ;;
  3) script_path="/etc/wptt/fail2ban/unban-all" ;;
  *)
    echo "${lua_chon_khong_hop_le:-L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá}: Index $index."
    return 1
    ;;
  esac

  # Ki·ªÉm tra v√† ch·∫°y script con
  if [[ -x "$script_path" ]]; then
    "$script_path" "$script_args"
  else
    echo "L·ªói: Kh√¥ng t√¨m th·∫•y ho·∫∑c kh√¥ng th·ªÉ th·ª±c thi script '$script_path'."
  fi
  # read -rp "Nh·∫•n Enter ƒë·ªÉ quay l·∫°i menu..." # B·ªè comment n·∫øu mu·ªën t·∫°m d·ª´ng
}
. /etc/wptt/wptt-callback-menu-chon
