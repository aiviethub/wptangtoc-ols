#!/bin/bash
. /etc/wptt/.wptt.conf
echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Quan ly Database => Thay doi phien ban maria database                  |"
echo "========================================================================="
echo ""
checkmaria=$(mysqld --version | grep mysqld | cut -f4 -d " " | cut -c 1-4)
echo "========================================================================="
echo "|Phien ban Maria Database hien tai ban dang su dung la $checkmaria      |"
echo "========================================================================="


echo "Ban hay lua chon phien ban Maria Database muon su dung: "
prompt="Nhap vao lua chon cua ban [1-3]: "
mariadb_version="10.5"
options=("Maria database phien ban: 10.6" "Maria database phien ban: 10.5" "Maria database phien ban: 10.4")
PS3="$prompt"
select opt in "${options[@]}"; do

  case "$REPLY" in
  1)
    mariadb_version="10.6"
    break
    ;;
  2)
    mariadb_version="10.5"
    break
    ;;

  3)
    mariadb_version="10.4"
    break
    ;;

  $((${#options[@]} + 1)))
    printf "\nHe thong se cai dat maria database 10.5\n"
    break
    ;;
  *)
    printf "Ban nhap sai, he thong cai dat maria database 10.5\n"
    break
    ;;
  esac

done

clear

if [[ "$checkmaria" = "$mariadb_version" ]];then
echo "Phien ban ban thay doi = voi phien ban hien tai ban dang su dung"
exit
fi
systemctl stop mariadb.service
yum remove MariaDB-* -y
echo '[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/'$mariadb_version'/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1' >/etc/yum.repos.d/MariaDB.repo
yum clean all
echo "Tien hanh cai dat Maria Database $mariadb_version"
yum install MariaDB-server MariaDB-client -y
systemctl start mariadb.service
systemctl enable mariadb.service
mysql_upgrade

echo "Hoan thanh thay doi phien ban maria database $mariadb_version"