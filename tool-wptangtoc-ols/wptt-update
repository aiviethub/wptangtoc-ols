#!/bin/bash
. /etc/wptt/.wptt.conf
clear
RED='\033[0;31m'
NC='\033[0m'
echo "//---------------------------------------------------------------------//"
echo "Cập nhật WPTangToc OLS"
echo "-------------------------------------------------------------------------"
echo "Kiểm tra... phiên bản của bạn"
echo -e "Phiên bản hiện tại của bạn là: ${RED} $version_wptangtoc_ols ${NC}"
echo "..."
sleep 2
echo ".."
echo "/-----------------------------------------------------------------------/"
wptangtocols_version=$(curl -s https://wptangtoc.com/share/version-wptangtoc-ols.txt?domain-update="$Website_chinh")
if [[ "$wptangtocols_version" = "$version_wptangtoc_ols" ]]; then
    echo "-----------------------------------------------------------------------"
    echo "###############   Bạn đang sử dụng phiên bản mới nhất   ###############"
    echo "-----------------------------------------------------------------------"
    sleep 4
    wptangtoc
else
    read -p "Xác nhận nâng cấp lên phiên bản WPTangToc OLS $wptangtocols_version ? (y/n): " dongy
    if [[ "$dongy" = 'y' ]]; then
        echo "Đang tiến hành cập nhật..."
        sleep 1
        echo "Đang cập nhật...Vui lòng không thoát trong tiến trình này."
        sleep 2
        cd
        rm -f wptangtoc-ols.zip
        wget -q https://wptangtoc.com/share/wptangtoc-ols.zip
        unzip -oq wptangtoc-ols.zip
        \cp -rf tool-wptangtoc-ols/* /etc/wptt/
        rm -f wptangtoc-ols.zip
        rm -rf tool-wptangtoc-ols
        chmod -R 740 /etc/wptt
        \cp -f /etc/wptt/wptangtoc /usr/bin
        rm -f /etc/wptt/wptangtoc
        \cp -f /etc/wptt/wptt /usr/bin
        rm -f /etc/wptt/wptt
        echo "Đang tiến hành cập nhật. Vui lòng đợi..."
        sleep 2

        sed -i "/version_wptangtoc_ols/d" /etc/wptt/.wptt.conf
        echo "version_wptangtoc_ols=$wptangtocols_version" >>/etc/wptt/.wptt.conf
		echo "$wptangtocols_version" > /tmp/wptangtoc-ols-version

        curl -sO https://wptangtoc.com/share/update && bash update
        rm -f update
        echo "/-----------------------------------------------------------------------/"
        echo "Qúa trình cập nhật hoàn tất"
        echo "/-----------------------------------------------------------------------/"
        echo -e "VPS của bạn đã được cập nhật lên phiên bản WPTangToc OLS mới nhất:${RED} $wptangtocols_version ${NC}"
        echo "/-----------------------------------------------------------------------/"
        sleep 3
        clear
        echo "Cảm ơn bạn đã lựa chọn WPTANGTOC OLS."
        echo "Phần mềm phát triển Bởi Gia Tuấn."
        sleep 1
        . /etc/wptt/wptt-status2
    fi
fi
